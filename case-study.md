# Case-study оптимизации


Текущая метрика - время исполнения скрипта

Создал фаилы размером 1мб, 10мб, 50мб, 100мб

Все тесты начал проводить на файле 1 мб

* Ruby prof показал что парсинг CSV занимает более 19% времени
    Сделал простое чтение из файла и парсинг строк
    Протестировал используя Benchmark ips - выигрыш по времени - 15%

* Ruby prof показал что парсинг даты занимет более 39% времени
    Тк формат совпадал - оставил дату как есть - только убрал переход на новю строку
    
* Ruby prof показал что постоянное преобразование массива браузеров в строку и обратно - занимает более 31% времени (String#split)
    Сделал постобработку перед созаднием json
    При формировании списка браузеров - просто формируем из них массив 

Далее не стал закапываться - тк уже более менее все равномерно

### В результате оптимизаций: 
Время обработки конечного файла уменьшилось с 69 - 73 сек до 27 - 28 сек - увеличение быстродействия вдвое
Но увеличилось потребление памяти с 939 - 956МБ до 1063 - 1131МБ - на 10% (посчитал это некритичным)

* Внедрил Progressbar
* Добавил тест на время исполнения
* Сделал профилировку rbspy
* Сделал профилировку с помощью valgrind massif - скриншот приложил

 